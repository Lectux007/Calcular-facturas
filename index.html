<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Control de Dinero</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #0f2027;  /* fondo oscuro */
      max-width: 500px;
      margin: auto;
      color: #e0f7fa;
    }
    h1, h2 {
      text-align: center;
      color: #64ffda;
      text-shadow: 0 0 8px #64ffda;
    }
    .campo {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      text-shadow: 0 0 5px #26c6da;
    }
    input[type="number"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #004d40;
      color: #b2dfdb;
      box-shadow: 0 0 10px #26c6da;
      transition: box-shadow 0.3s ease;
    }
    input[type="number"]:focus {
      outline: none;
      box-shadow: 0 0 20px #00bcd4;
      color: #ffffff;
      background: #00796b;
    }
    .valores-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #004d40;
      background: #40c4ff;
      box-shadow: 0 0 12px #26c6da;
      transition: background 0.3s ease;
      text-shadow: 0 0 4px #006064;
    }
    button:hover {
      background: #00acc1;
      color: #e0f7fa;
      box-shadow: 0 0 20px #00bcd4;
    }
    #resultado {
      text-align: center;
      margin-top: 20px;
      font-size: 1.3em;
      color: #26c6da;
      text-shadow: 0 0 8px #26c6da;
      min-height: 2em;
    }
    #historial {
      background: #004d40;
      padding: 10px;
      border-radius: 6px;
      max-height: 200px;
      overflow-y: auto;
      color: #b2dfdb;
      box-shadow: inset 0 0 10px #00bcd4;
    }
  </style>
</head>
<body>
  <h1>Control de Dinero</h1>

  <div class="campo">
    <label>Valores:</label>
    <div id="valores" class="valores-container"></div>
    <button id="btnAgregar">+ A√±adir valor</button>
  </div>

  <div class="campo">
    <label>Dinero recibido:</label>
    <input id="dineroRecibido" type="number" inputmode="decimal" />
  </div>

  <button id="btnCalcular">Calcular</button>
  <button id="btnLimpiar">Actualizar valores</button>

  <h2 id="resultado"></h2>

  <h3>Historial:</h3>
  <div id="historial"></div>
  <button id="btnBorrarHistorial">üóëÔ∏è Borrar historial</button>

  <script>
    const valoresContainer = document.getElementById('valores');
    const dineroRecibido = document.getElementById('dineroRecibido');
    const resultado = document.getElementById('resultado');
    const historialDiv = document.getElementById('historial');

    const btnAgregar = document.getElementById('btnAgregar');
    const btnCalcular = document.getElementById('btnCalcular');
    const btnLimpiar = document.getElementById('btnLimpiar');
    const btnBorrarHistorial = document.getElementById('btnBorrarHistorial');

    // Sonidos
    const beepSound = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
    const errorSound = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
    const destructionSound = new Audio('https://actions.google.com/sounds/v1/explosions/explosion_4.ogg');

    function agregarValor(valor = '') {
      const input = document.createElement('input');
      input.type = 'number';
      input.inputMode = 'decimal';
      input.value = valor;
      input.placeholder = '0.00';

      // Actualiza suma autom√°tica al cambiar valor
      input.addEventListener('input', mostrarSumaAutomatica);

      valoresContainer.appendChild(input);
      beepSound.play();
      mostrarSumaAutomatica();
    }

    function obtenerSumaValores() {
      let suma = 0;
      document.querySelectorAll('#valores input').forEach(input => {
        const val = parseFloat(input.value);
        if (!isNaN(val)) suma += val;
      });
      return suma;
    }

    function mostrarSumaAutomatica() {
      const total = obtenerSumaValores();
      resultado.textContent = `Total actual: ${total.toFixed(2)}`;
    }

    function calcular() {
      const total = obtenerSumaValores();
      const recibido = parseFloat(dineroRecibido.value) || 0;
      if (recibido < total) {
        errorSound.play();
        alert('Error: El dinero recibido es menor que la suma de los valores.');
        return;
      }
      const devuelto = recibido - total;

      resultado.innerHTML = `
        Total: ${total.toFixed(2)}<br>
        Dinero recibido: ${recibido.toFixed(2)}<br>
        Dinero devuelto: ${devuelto.toFixed(2)}
      `;

      guardarHistorial(total, recibido, devuelto);
    }

    function limpiarCampos() {
      valoresContainer.innerHTML = '';
      dineroRecibido.value = '';
      resultado.textContent = '';
      agregarValor();
    }

    function guardarHistorial(total, recibido, devuelto) {
      const fecha = new Date().toLocaleString();
      const entrada = { fecha, total, recibido, devuelto };
      let historial = JSON.parse(localStorage.getItem('historial') || '[]');
      historial.unshift(entrada);
      localStorage.setItem('historial', JSON.stringify(historial));
      mostrarHistorial();
    }

    function mostrarHistorial() {
      let historial = JSON.parse(localStorage.getItem('historial') || '[]');
      historialDiv.innerHTML = historial.map(item =>
        `<div><strong>${item.fecha}</strong>: Total ${item.total.toFixed(2)} | Recibido ${item.recibido.toFixed(2)} | Devuelto ${item.devuelto.toFixed(2)}</div>`
      ).join('');
    }

    function borrarHistorial() {
      if (confirm("¬øEst√°s seguro de que quieres borrar todo el historial?")) {
        localStorage.removeItem('historial');
        mostrarHistorial();
        playDestruction();
      }
    }

    function playDestruction() {
      destructionSound.play();
    }

    // Eventos botones
    btnAgregar.addEventListener('click', () => agregarValor());
    btnCalcular.addEventListener('click', calcular);
    btnLimpiar.addEventListener('click', limpiarCampos);
    btnBorrarHistorial.addEventListener('click', borrarHistorial);

    // Inicializaci√≥n
    agregarValor();
    mostrarHistorial();

  </script>
</body>
</html>
